<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>地名百科</title>

	<link rel='icon' href='../../images/fav.ico ' type=‘image/x-ico’ />
	<!-- Core CSS - Include with every page -->
	<link href="../../js/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="../../font-awesome/css/font-awesome.css" rel="stylesheet">
	<link href="../../css/plugins/social-buttons/social-buttons.css" rel="stylesheet">
	<link href="../../css/jquery-ui.min.css" rel="stylesheet" />

	<!--<link href="css/hummingmap.css" rel="stylesheet"/>-->
	<link href="../../css/kkpager.css" rel="stylesheet"/>
	<link href="../../css/search.css" rel="stylesheet"/>
	<!--<link href="js/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet"/>-->
	<link href="../../css/index.css" rel="stylesheet"/>
	<link href="../../css/spinkit.css" rel="stylesheet"/>
	<link href="../../css/jquery.autocomplete.css" rel="stylesheet"/>
	<link rel="stylesheet" href="../../css/jquery.treeview.css" />
	<link rel="stylesheet" href="../../css/screen.css" />
	<link rel="stylesheet" href="../../css/inline.style.sheet4.css" />

	<style>
		/*.my-map { width: 100%; height: 100%; }*/
		/*.my-map .icon { background: url(http://lbs.amap.com/console/public/show/marker.png) no-repeat; }*/
		/*.my-map .icon-cir { height: 31px; width: 28px; }*/
		/*.my-map .icon-cir-red { background-position: -11px -5px; }*/
		.amap-container{height: 100%; width: 100%; overflow:scroll}
		body,html,#mapContainer{
			height: 100%;
			width: 100%;
			margin: 0px;
			font:12px Arial;
		}
		.taiwan{
			border: solid 1px red;
			color: red;
			float: left;
			width: 50px;
			background-color: rgba(255,0,0,0.1)
		}
		.info {
			border: solid 1px silver;
			background-color: #FFFFFF;
		}
		div.info-top {
			position: relative;
			background: none repeat scroll 0 0 #F9F9F9;
			border-bottom: 1px solid #CCC;
			border-radius: 5px 5px 0 0;
		}
		div.info-top div {
			display: inline-block;
			color: #333333;
			font-size: 14px;
			font-weight: bold;
			line-height: 31px;
			padding: 0 10px;
		}
		div.info-top img {
			position: absolute;
			top: 10px;
			right: 10px;
			transition-duration: 0.25s;
		}
		div.info-top img:hover {
			box-shadow: 0px 0px 5px #000;
		}
		div.info-middle {
			font-size: 12px;
			padding: 6px;
			line-height: 20px;
		}
		div.info-bottom {
			height: 0px;
			width: 100%;
			clear: both;
			text-align: center;
		}
		div.info-bottom img {
			position: relative;
			z-index: 104;
		}
		span {
			margin-left: 5px;
			font-size: 11px;
		}
		.info-middle img {
			float: left;
			margin-right: 6px;
		}
	</style>


	<script type="text/javascript" src="../../js/jquery.js"></script>
    <!--<script src="js/jquery-1.10.2.min.js"></script>-->
	<script src="../../js/jquery-ui.min.js"></script>
	<script src="../../js/jquery.cookie.js"></script>
	<script src="../../js/jquery.treeview.js" type="text/javascript"></script>
	<script src="../../js/jquery.treeview.edit.js" type="text/javascript"></script>
	<!--<script src="js/jquery.autocomplete.js" type="text/javascript"></script>-->
	<script src="http://webapi.amap.com/js/marker.js"></script>
	<script src="http://webapi.amap.com/maps?v=1.3&key=8325164e247e15eea68b59e89200988b&plugin=AMap.Transfer,AMap.Walking,AMap.Driving,AMap.PlaceSearch,AMap.ToolBar,AMap.Marker"></script>
	<script type="text/javascript" src="http://webapi.amap.com/demos/js/liteToolbar.js"></script>
	<script src="../../data/testdata.js" type="text/javascript" charset=”utf-8″></script>
	<script type='text/javascript' src='../../js/jquery.autocomplete.js'></script>
	<script type='text/javascript' src='../../localdata.js'></script>


</head>

<body>

<!--<input type="text" id="suggest13" />-->
    <div id="hm_header" class="hmbar-header hmbar-default">
        <a class="navbar-brand" href="index.html">
            <img src="images/logo.png" />
        </a>

        <div class="hm-searchpanel">
            <div id='hm_searchinput' class="input-group custom-search-form">
                <input id="autocomplete" title="提示: &quot;输入搜索关键字&quot;" placeholder="地名百科搜索..." class="form-control" />

				<span class="input-group-btn">
				<button id="search" class="btn btn-default" type="button">
					<i class="fa fa-search"></i>
				</button>
				</span>
            </div>
        </div>
    </div>

	<div id="hm_sidebar" class="hmbar-side hmbar-default ">
		<!-- 边栏表头 -->
        <div id="infohead" class="hm-infohead">
            <div id="hm_wikinav" class="headnav-default">
                <p><i class="fa fa-lg fa-th fa-fw"></i> 行政区划</p>
            </div>
            <div id="hm_classnav" class="headnav-default">
                <p><i class="fa fa-lg fa-th-large fa-fw"></i> 地名分类</p>
            </div>
            <div id="hm_favnav" class="headnav-default">
                <p><i class="fa fa-lg fa-ticket fa-fw"></i> 路径规划</p>
            </div>
        </div>
		<!-- 路径规划 -->
		<div id="hm_favorites" class="hm-favorites">
			<div id="pathinfo1" class="pathinfo1"></div>
		</div>

		<div id="hm_mapInfo" class="hm-mapinfo">
			<!-- 地名类型 -->
            <div id="hm_infoClass" class="hm-infoclass">
				<div class="hm-wikiAdv">
					<div id="sidetreecontrol1"> <a href="#">全部收起</a> | <a href="#">全部展开</a> </div>

					<ul class="treeview" id="tree1">
						<li class="expandable" id="folder0">
							<div class="hitarea expandable-hitarea"></div><a href="#" onclick="gotoBigType('行政区域类')">行政区域类</a>
							<ul style="display: none;">
								<li class="last">
									<a href="#/index.cfm" onclick="gotoSmallType('行政区域类', '行政区域')">行政区域</a>
								</li>
							</ul>
						</li>
						<li class="expandable"><div class="hitarea expandable-hitarea"></div><a href="#" onclick="gotoBigType('非行政区域类')">非行政区域类</a></li>
						<li class="expandable"><div class="hitarea expandable-hitarea"></div><a href="#/index.cfm">群众自治组织类</a></li>
						<li class="expandable"><div class="hitarea expandable-hitarea"></div><a href="#/index.cfm">居民点类</a></li>
						<li class="expandable"><div class="hitarea expandable-hitarea"></div><a href="#/index.cfm">交通运输设施类</a></li>
						<li class="expandable"><div class="hitarea expandable-hitarea"></div><a href="#/index.cfm">水利电力设施类</a></li>
						<li class="expandable"><div class="hitarea expandable-hitarea"></div><a href="#/index.cfm">纪念地旅游景点类</a></li>
						<li class="expandable"><div class="hitarea expandable-hitarea"></div><a href="#/index.cfm">建筑物类</a></li>
						<li class="expandable"><div class="hitarea expandable-hitarea"></div><a href="#/index.cfm">单位类</a></li>
						<li class="expandable"><div class="hitarea expandable-hitarea"></div><a href="#/index.cfm">陆地水系类</a></li>
						<li class="last"><div class="hitarea expandable-hitarea"></div><a href="#/index.cfm">陆地地形类</a></li>
					</ul>
				</div>
			</div>

			<!--  行政区划 -->
            <div id="hm_wikiClass" class="hm-wikiClass">
                <div class="hm-wikiAdv">
					<div id="sidetreecontrol2"> <a href="#">全部收起</a> | <a href="#">全部展开</a> </div>
					<ul class="treeview" id="tree2">
						<li class="expandable" id="folder1">
							<div class="hitarea expandable-hitarea"></div>
							<a href="#">湖北省</a>
							<ul>
								<li class="expandable"><div class="hitarea expandable-hitarea"></div><a href="#">武汉市</a></li>
								<li class="expandable"><div class="hitarea expandable-hitarea"></div><a href="#">恩施土家族苗族自治州</a></li>
								<li class="expandable"><div class="hitarea expandable-hitarea"></div><a href="#">黄石市</a></li>
								<li class="expandable"><div class="hitarea expandable-hitarea"></div><a href="#">十堰市</a></li>
								<li class="expandable"><div class="hitarea expandable-hitarea"></div><a href="#">宜昌市</a></li>
								<li class="expandable"><div class="hitarea expandable-hitarea"></div><a href="#">襄阳市</a></li>
								<li class="expandable"><div class="hitarea expandable-hitarea"></div><a href="#">鄂州市</a></li>
								<li class="expandable"><div class="hitarea expandable-hitarea"></div><a href="#">荆门市</a></li>
								<li class="expandable"><div class="hitarea expandable-hitarea"></div><a href="#">孝感市</a></li>
								<li class="expandable"><div class="hitarea expandable-hitarea"></div><a href="#">荆州市</a></li>
								<li class="expandable"><div class="hitarea expandable-hitarea"></div><a href="#">黄冈市</a></li>
								<li class="expandable"><div class="hitarea expandable-hitarea"></div><a href="#">咸宁市</a></li>
								<li class="expandable"><div class="hitarea expandable-hitarea"></div><a href="#">随州市</a></li>
								<li class="last"><div class="hitarea expandable-hitarea"></div><a href="#">省直辖县级行政单位</a></li>
							</ul>
									</li>
					</ul>
                </div>
            </div>



		</div>

		<div id="searchresults" class="SearchResult">
			<div id="resultitems"></div>
			<div id="hm_Paginate"></div>
		</div>

	</div>
	<!--地图容器-->
    <div id="hm_content" class="hmbar-content">
		<!--<div id="wrap" class="my-map">-->
			<div id="mapContainer"></div>

    </div>


	<!--<script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key=ce2cdf09c48f5eda3b45a3ac24ee19ca&plugin=AMap.DistrictSearch"></script>-->

    <script type="text/javascript" src="../../js/echarts/echarts-all.js"></script>

    <script data-main="js/main" src="../../js/require.js"></script>

	<!-- 主地图操作 -->
	<script type="text/javascript">

		var infoWindow, map, level = 12;
		var markers = [];
		var showingPlaces;
		var windata;
		var hasAutoCom = false;
		var orgdata, destdata;

		function mapFeatureClick(e){
			openInfoWindow(e.target.getExtData());
		}

		//构建自定义信息窗体
		function createInfoWindow(title, content) {
			var info = document.createElement("div");
			info.className = "info";

			//可以通过下面的方式修改自定义窗体的宽高
			//info.style.width = "400px";
			// 定义顶部标题
			var top = document.createElement("div");
			var titleD = document.createElement("div");
			var closeX = document.createElement("img");
			top.className = "info-top";
			titleD.innerHTML = title;
			closeX.src = "http://webapi.amap.com/images/close2.gif";
			closeX.onclick = closeInfoWindow;

			top.appendChild(titleD);
			top.appendChild(closeX);
			info.appendChild(top);

			// 定义中部内容
			var middle = document.createElement("div");
			middle.className = "info-middle";
			middle.style.backgroundColor = 'white';
			middle.innerHTML = content;
			info.appendChild(middle);

			//	定义下部内容
			var down = document.createElement("div");
			down.className = "amap-info-combo status-origin";
			down.setAttribute("id", "winbtm");
//			down.setAttribute("style", "background-color: #FFFFFF");
			var downstr = "" +
//			"<div class=\"amap-info-combo status-origin\" id=\"winbtm\">" +
				"<table><tbody>"+
					"<tr class=\"amap-info-tabs\">" +
						"<td class=\"tab\" id=\"findnear\" onclick=\"selectsrhmethod(this)\"><i class=\"tab-icon icon-around\"></i>在附近找</td>" +
						"<td class=\"tab selected\" id=\"fromhere\" onclick=\"selectsrhmethod(this)\"><i class=\"tab-icon icon-start\"></i>这里出发</td>" +
						"<td class=\"tab\" id=\"tothere\" onclick=\"selectsrhmethod(this)\"><i class=\"tab-icon icon-end\"></i>到这里去</td>" +
					"</tr></tbody>" +
				"</table>" +
				"<table cellpadding=\"0\"><tbody>" +
					"<tr>" +
						"<td class=\"input-label\" id=\"startorend\">终点</td>" +
						"<td>" +
							"<div class=\"keyword-input\"><input class=\"keyword\" type=\"text\" id=\"winsrhword\" onkeydown=\"srhkeydown();\" /></div>" +
						"</td>" +
						"<td>" +
							"<div class=\"search-button hide\" id=\"poisrhbtn\" onclick=\"srhpoi();\">搜索</div>" +
							"<div class=\"nav-button\" id=\"navsrhdiv\">" +
								"<span class=\"nav-icon nav-drive\" id=\"drivesrhbtn\" onclick=\"srhdrive();\">驾车</span>" +
								"<span class=\"nav-icon nav-bus\" id=\"bussrhbtn\" onclick=\"srhbus();\">公交</span>" +
								"<span class=\"nav-icon nav-walk\" id=\"walksrhbtn\" onclick=\"srhwalk();\">步行</span>" +
							"</div>" +
						"</td>" +
					"</tr></tbody>" +
				"</table>"
//			 + "</div>"
					;
			down.innerHTML = downstr;
//			info.innerHTML += downstr;
			info.appendChild(down);
			// 定义底部内容
			var bottom = document.createElement("div");
			bottom.className = "info-bottom";
			bottom.style.position = 'relative';
			bottom.style.top = '0px';
			bottom.style.margin = '0 auto';
			var sharp = document.createElement("img");
			sharp.src = "images/sharp.png";
			bottom.appendChild(sharp);
			info.appendChild(bottom);

//			var bottom = document.createElement("div");
//			bottom.className = "amap-combo-sharp";
//			info.appendChild(bottom);

			return info;
		}

		function openInfoWindow(data) {
			var extData = data;
			var title = extData.name + '<span style="font-size:11px;color:#F00;">&nbsp;&nbsp;' + extData['小类'] + '</span>';
			var content = [];
			content.push("<img src='images/contentdemopic.jpg'>"
					+ "<strong>地名含义：</strong>" + extData.desc);
			content.push("<strong>行政区：</strong>" + extData['所在（跨）行政区']);
			content.push("<a href='html/wikiContent_fitall.html?name=" + extData.nickname + "' target='_blank'>详细信息</a>");
			closeInfoWindow();
			infoWindow = new AMap.InfoWindow({
				isCustom: true,  //使用自定义窗体
				content: createInfoWindow(title, content.join("<br>")),
				offset: new AMap.Pixel(14, -47)//-113, -140
			});
			infoWindow.on('open', function () {
				windata = data;
//				infoWindow.setContent(infoWindow.getContent().join("<br>"));
//				$("#findnear").on("click", "div", this, selectsrhmethod);
//				$("#fromhere").on("click", "div", this, selectsrhmethod);
//				$("#tothere").on("click", "div", this, selectsrhmethod);
//				$("#winsrhword").autocomplete(placedata, {
//					minChars: 1,
//					max: 5,
//					autoFill: true,
//					mustMatch: true,
//					matchContains: true,
//					formatItem: function (data, i, total) {
//						return data.name;
//					},
//					formatMatch: function (data, i, total) {
//						return data.name;
//					},
//					formatResult: function (data) {
//						return data.name;
//					}
//				}).result(function(event, item) {
//					$("#winsrhword").innerText = item.name;
////					location.href = item.url;
//				});


			});
			infoWindow.on('close', function () {
				hasAutoCom = false;
				var srhdiv = document.getElementById("winbtm");
				srhdiv.setAttribute("id", "oldwinbtm");
				srhdiv.innerHTML = " ";
			});
			infoWindow.on('change', function () {

			});

			infoWindow.open(map, data.position);


		}

		function closeInfoWindow() {
			if(infoWindow) {
				infoWindow.close();
				map.clearInfoWindow();
				infoWindow = null;
			}
		}

		function srhpoi() {
			var item0 = consPlaceResult(windata, "中");

			var inputele = document.getElementById("winsrhword");
			var srhtxt = inputele.value;
			var placeSearch = new AMap.PlaceSearch({ //构造地点查询类
				pageSize: 5,
				pageIndex: 1,
				city: windata.citycode, //城市
				map: map,
				panel: "pathinfo1"
			});
			placeSearch.searchNearBy(srhtxt, windata.position, 500, function(status, result) {
				var test = 0;
			});
			closeWindBySearch();
			clearNavPanel();
			setResultsInDiv([item0], "pathinfo1");
		}

		function srhdrive() {
			var transOptions = createTransOption();
			var trans = new AMap.Driving(transOptions);
			trans.search(orgdata.position, destdata.position, function(status, result) {
				//TODO:开发者使用result自己创建交互面板和地图展示
			});
			closeWindBySearch();
		}

		function srhbus() {
			var transOptions = createTransOption();
			var trans = new AMap.Transfer(transOptions);
			trans.search(orgdata.position, destdata.position, function(status, result) {
				//TODO:开发者使用result自己创建交互面板和地图展示
			});
			closeWindBySearch();
		}

		function srhwalk() {
			var transOptions = createTransOption();
			var trans = new AMap.Walking(transOptions);
			trans.search(orgdata.position, destdata.position, function(status, result) {
				//TODO:开发者使用result自己创建交互面板和地图展示
			});
			closeWindBySearch();
		}

		function createTransOption() {
			var inputele = document.getElementById("winsrhword");
			var srhtxt = inputele.value;
			var soe = document.getElementById("startorend");
			var otherplace = findPlaceByName("name", srhtxt);
			if(soe.innerHTML == "起点") {
				orgdata = otherplace;
				destdata = windata;
			} else {
				orgdata = windata;
				destdata = otherplace;
			}
			var item1 = consPlaceResult(orgdata, "起");
			var item2 = consPlaceResult(destdata, "终");
			clearNavPanel();
			setResultsInDiv([item1, item2], "pathinfo1");

			var transOptions = {
				city: orgdata.citycode,
				citid: destdata.citycode,
//				policy: AMap.TransferPolicy.LEAST_TIME,
				map: map,
				panel: "pathinfo1"
			};
			return transOptions;
		}


		function findPlaceByName(attr, _name) {
			var pla = null;
			for(var i = 0; i < placedata.length; i++) {
				var testplace = placedata[i];
				if(testplace[attr] == _name) {
					pla = testplace;
					break;
				}
			}
			return pla;
		}

		function closeWindBySearch() {
			closeInfoWindow();
			map.clearMap();
			initmarkers();
			toChangeHead("hm_favnav");
		}
		
		function clearNavPanel() {
			var navPanel = document.getElementById("pathinfo1");
			navPanel.innerHTML = "";
		}
		
		function selectsrhmethod(e) {
			var oid = e.id;
			var posObj = document.getElementById("findnear");
			var fhObj = document.getElementById("fromhere");
			var thObj = document.getElementById("tothere");

			switch(oid) {
				case "findnear":{
					posObj.className = "tab selected";
					fhObj.className = "tab";
					thObj.className = "tab";

					$("#startorend")[0].innerHTML = "";
					$("#poisrhbtn")[0].className = "search-button";
					$("#navsrhdiv")[0].className = "nav-button hide";
					break;
				}
				case "fromhere":{
					posObj.className = "tab";
					fhObj.className = "tab selected";
					thObj.className = "tab";
					$("#startorend")[0].innerHTML = "终点";
					$("#poisrhbtn")[0].className = "search-button hide";
					$("#navsrhdiv")[0].className = "nav-button";
					break;
				}
				case "tothere":{
					posObj.className = "tab";
					fhObj.className = "tab";
					thObj.className = "tab selected";
					$("#startorend")[0].innerHTML = "起点";
					$("#poisrhbtn")[0].className = "search-button hide";
					$("#navsrhdiv")[0].className = "nav-button";
					break;
				}
			}


		}

		function srhkeydown() {
//			if(hasAutoCom) {
//				return;
//			}
//			hasAutoCom = true;
//			var srhinput = document.getElementById("winsrhword");
//			$("#winsrhword").autocomplete(placedata, {
//
//				minChars: 0,
//				width: 310,
////					matchContains: "word",
//				autoFill: true,
//				formatItem: function(row, i, max) {
//					return row.nickname;
//				},
//				formatMatch: function(row, i, max) {
//					return row.nickname;
//				},
//				formatResult: function(row) {
//					return row.nickname;
//				}
//			});
//			hasAutoCom = true;
		}

		function advance() {
//			AMap.plugin('AMap.AdvancedInfoWindow', function () {
//				var showpa = document.getElementById("pathinfo1");
//				infoWindow = new AMap.AdvancedInfoWindow({
//					content: createInfoWindow(title, content.join("<br>")),
//					offset: new AMap.Pixel(0, -30),
//					panel: showpa,
//				});
//				infoWindow.on('complete', function (result) {
//					var overs = map.getAllOverlays();
////					showNarkers(showingPlaces);
//					var oldhtml = showpa.innerHTML;
//					var elems = document.getElementsByClassName("keyword");
//					var srhname = elems[elems.length - 1].value;
//
//					if (result.type == "placesearch") {
////						var item0 = consPlaceResult(data, "C");
////						setResultsInDiv([item0], "pathinfo1");
////						showpa.innerHTML += oldhtml;
//					} else {
//						if (result.type == "driving") {
////							showpa.innerHTML += oldhtml;
////							showpa.innerHTML = "";
//						} else {
//							map.clearMap();
//							initmarkers();
//							var item1, item2;
//							var resata = result.data;
//							var poso = resata.origin, posd = resata.destination;
//							if (poso.lng == data.position[0] && poso.lat == data.position[1]) {	//	起点
//								item1 = consPlaceResult(data, "起");
//								item2 = consResultItem(srhname, [posd.lng, posd.lat], "高德地图元素", "终", "地理位置：" + posd);
//								setResultsInDiv([item1, item2], "pathinfo1");
//							} else {	//	终点
//								item1 = consResultItem(srhname, [poso.lng, poso.lat], "高德地图元素", "起", "地理位置：" + poso);
//								item2 = consPlaceResult(data, "终");
//								setResultsInDiv([item1, item2], "pathinfo1");
//							}
//						}
//					}
//					toChangeHead("hm_favnav");
////					document.getElementById("hm_mapInfo").style.display = "block";
////					document.getElementById("searchresults").style.display = "none";
////					document.getElementById("hm_infoClass").style.display = "none";
////					document.getElementById("hm_wikiClass").style.display = "none";
////					document.getElementById("hm_favorites").style.display = "block";
////					showpa.style.display = "block";
//				});
//
//				infoWindow.on('change', function () {
////					alert("change");
////					var ddivs = document.getElementsByClassName("nav-icon nav-drive");
////					var tdivs = document.getElementsByClassName("nav-icon nav-bus");
////					var wdivs = document.getElementsByClassName("nav-icon nav-walk");
////					for(var i=0;i<ddivs.length;i++) {
////						var button = ddivs[i];
////						if(button) {
////							button.removeEventListener("click", clearMapResult);
////							button.addEventListener("click", clearMapResult);
////						}
////					}
////					for(var i=0;i<tdivs.length;i++) {
////						var button = tdivs[i];
////						if(button) {
////							button.removeEventListener("click", clearMapResult);
////							button.addEventListener("click", clearMapResult);
////						}
////					}
////					for(var i=0;i<wdivs.length;i++) {
////						var button = wdivs[i];
////						if(button) {
////							button.removeEventListener("click", clearMapResult);
////							button.addEventListener("click", clearMapResult);
////						}
////					}
//				});
//				infoWindow.on('error', function (errorstatus) {
//					alert("查询出现错误...");
//				});
//				infoWindow.on('open', function () {
//					var test = 0;
////					infoWindow.setContent(createInfoWindow(title,content.join("<br>")));
//				});
//				infoWindow.on('close', function () {
//					var test = 0;
//				});
//				infoWindow.open(map, data.position);
//			});

//			var favoritesObj = document.getElementById("hm_favorites");
		}

		function toChangeHead(oid) {
			var titles=["hm_wikinav", "hm_classnav", "hm_favnav"];
			var infoClassObj = document.getElementById("hm_infoClass");
			var favoritesObj = document.getElementById("hm_favorites");
			var wikiClassObj = document.getElementById("hm_wikiClass");

			for(var i = 0;i < titles.length; i++) {
				var title = titles[i];
				var preHeadObj = document.getElementById(title);
				var reg = new RegExp('(\\s|^)' + "active" + '(\\s|$)');
				preHeadObj.className = preHeadObj.className.replace(reg, ' ');
			}
			document.getElementById(oid).className += " active";
			document.getElementById("hm_mapInfo").style.display="block";
			document.getElementById("searchresults").style.display="none";
			switch(oid) {
				case "hm_classnav":{
					infoClassObj.style.display="block";
					favoritesObj.style.display="none";
					document.getElementById("pathinfo1").style.display = "none";
					wikiClassObj.style.display="none";
					break;
				}
				case "hm_favnav":{
					infoClassObj.style.display="none";
					favoritesObj.style.display="block";
					document.getElementById("pathinfo1").style.display = "block";
					wikiClassObj.style.display="none";
					break;
				}
				case "hm_wikinav":{
					infoClassObj.style.display="none";
					favoritesObj.style.display="none";
					document.getElementById("pathinfo1").style.display = "none";
					wikiClassObj.style.display="block";
					break;
				}
			}
		}

		function clearMapResult() {
//			map.clearMap();
//			var overs =  map.getAllOverlays(AMap.Marker);
//			for(var i = 0;i < overs.length; i++) {
//				overo = overs[i];
//				overo.hide();
//			}
//			map.remove(overs);
//			showNarkers(showingPlaces);
			var resultpanel = document.getElementById("pathinfo1");
			var oldhtml = resultpanel.innerHTML;
			resultpanel.innerHTML = "";
			return oldhtml;
		}

		function gotoBigType(bigtype) {
			var tmpdata = [];
			for (var i = 0; i < placedata.length; i++) {
				var data = placedata[i];
				if(data['大类'] == bigtype) {
					tmpdata.push(data);
				}
			}
			if(tmpdata.length > 0) {
				showingPlaces = tmpdata;
				setNewMarkers(tmpdata);
				setResultItems(tmpdata, "searchresults");
			} else {
				alert("暂无 " + bigtype + " 相关数据...");
			}
		}

		function gotoSmallType(bigtype, smalltype) {
			var tmpdata = [];
			for (var i = 0; i < placedata.length; i++) {
				var data = placedata[i];
				var flag = false;
				if(data['大类'] == bigtype && data['小类'] == smalltype) {
					tmpdata.push(data);
				}
			}
			if(tmpdata.length > 0) {
				showingPlaces = tmpdata;
				setNewMarkers(tmpdata);
				setResultItems(tmpdata, "searchresults");
			} else {
				alert("暂无 " + bigtype +"-" + smalltype + " 相关数据...");
			}
		}

		function gotoDist(dictcode) {

			var tmpdata = [];
			for (var i = 0; i < placedata.length; i++) {
				var data = placedata[i];
				var thiscode = data['dist'];
				if(distIn(thiscode, dictcode)) {
					tmpdata.push(data);
				}
			}
			if(tmpdata.length > 0) {
				showingPlaces = tmpdata;
				setNewMarkers(tmpdata);
				setResultItems(tmpdata, "searchresults");
			} else {
				alert("暂无 " + dictcode + " 地区相关数据...");
			}
		}

		function gotoPlace(posStr) {
			var [xstr, ystr] = posStr.split(",");
			var x = parseFloat(xstr);
			var y = parseFloat(ystr);
			var npos = [x, y];
			var zom = map.getZoom();
			if(zom < 16) {
				map.setZoom(16);
//				if(zom < 14) {
//					map.setZoom(14);
//				} else {
//					map.setZoom(zom + 1);
//				}
			}
			map.setCenter(npos);
//			openInfoWindow(placedata);
		}

		function distIn(sub, par) {
			var i = 0;
			for(i = 0; i < sub.length; i++) {
				var c1 = sub.charCodeAt(i), c2 = par.charCodeAt(i);
				if(c1 != c2) {
					break;
				}
			}
			for( ;i < par.length; i++) {
				var c = par.charCodeAt(i);
				if(c != 48) {
					return false;
				}
			}
			return true;
		}

		function setNewMarkers(newdata) {
			while (markers.length > 0) {
				map.remove(markers);
				markers.pop();
			}
			closeInfoWindow();
			for(var i = 0; i < newdata.length; i++) {
				var data = newdata[i];
				var marker;
				marker = new AMap.Marker({
					map: map,
					position: data.position,
					zIndex: 3,
					extData: data,
					title: data.name,
					label: data.name.substring(0, 1),
				});
				AMap.event.addListener(marker, "click", mapFeatureClick);
				markers.push(marker);
			}
			map.setFitView();
		}

		function setResultItems(muldata, divname) {

			var parentdiv = document.getElementById(divname);
			parentdiv.style.display="block";
			var prestr = "<div class='list-group'>", endstr = "</div>", midstr = "";
			for(var i = 0; i < muldata.length; i++) {
				var data = muldata[i];
				var str = consPlaceResult(data, i + 1);
				midstr += str;
			}
			var totalstr = prestr + midstr + endstr;
			parentdiv.innerHTML = totalstr;
		}

		function setResultsInDiv(items, divname) {
			var parentdiv = document.getElementById(divname);
			parentdiv.style.display="block";
			var prestr = "<div class='list-group'>", endstr = "</div>", midstr = "";
			for(var i = 0; i < items.length; i++) {
				midstr += items[i];
			}
			var totalstr = prestr + midstr + endstr;
			parentdiv.innerHTML = totalstr;
		}

		function consResultItem(name, pos, type, order, content){
			var posstr = pos[0] +"," + pos[1];
			str = "<div class='list-group-item'" +"onclick='gotoPlace(\""+ posstr + "\")'" +
					"><div class='SearchResult_item_left' " +
					"><p><strong>" + order +
					"</strong></p></div><div class='SearchResult_item_content'>" +
					"<p><font color='#0B73EB'>" + name +
					"</font><span class='wikiTag'>" + type +
					"</span></p><p>" + content + "</p></div></div>";
			return str;
		}

		function consPlaceResult(place, order) {
			return consResultItem(place.name, place.position, place['小类'], order, "地域代码：" + place.dist);
//			var rstr = place.position[0] +"," + place.position[1];
//			str = "<div class='list-group-item'" +"onclick='gotoPlace(\""+ rstr + "\")'" +
//					"><div class='SearchResult_item_left' " +
//					"><p><strong>" + order +
//					"</strong></p></div><div class='SearchResult_item_content'>" +
//					"<p><font color='#0B73EB'>" + place.name +
//					"</font><span class='wikiTag'>" + place['小类'] +
//					"</span></p><p>地域代码：" + place.dist + "</p></div></div>";
//			return str;
		}

		function setTypes() {
			var wholetree = document.getElementById("tree1");
			var temp = document.getElementById("folder0");
			var inner1 = "<li class='expandable'>";
			var inner2 = "</li>";
			var branches = $(inner1 + "<div class='hitarea expandable-hitarea'></div>" +
					"<a href='#'>所有分类</a><ul id='dlist'></ul>" + inner2).appendTo("#folder0");
			var branchdom =$('#dlist')[0];
			var subDistricts = typedata.subclasses;
			for (var i = 0; i < subDistricts.length; i += 1) {	//	省内各城市
				var city = subDistricts[i];
				var cityname = city.name;
				var citynode = document.createElement("li");
				var $cn = $(citynode);
				if(i == subDistricts.length - 1) {
					citynode.setAttribute("class", "last");
				} else {
					citynode.setAttribute("class", "expandable");
				}
				var citydiv = document.createElement("div");
				citydiv.setAttribute("class", "hitarea expandable-hitarea");
				var citya = document.createElement("a");
				citya.setAttribute("href", "#");
				citya.setAttribute("class", "");
				citya.setAttribute("onclick", "gotoBigType('" + cityname + "')");
				var citytext = document.createTextNode(cityname);
				citya.appendChild(citytext);
				citynode.appendChild(citydiv);
				citynode.appendChild(citya);
				if (!city.subclasses) {
					branchdom.appendChild(citynode);
					continue;
				}
				var streetlist = document.createElement("ul");
				streetlist.setAttribute("style", "display: none;");
				for (var k = 0; k < city.subclasses.length; k++) {	//	区县内各街道
					var street = city.subclasses[k];
					var streetname = street.name;
					var streetnode = document.createElement("li");
					var streeta = document.createElement("a");
					streeta.setAttribute("href", "#");
					streeta.setAttribute("onclick", "gotoSmallType('"+cityname+"', '"+streetname+"')");
					var streettext = document.createTextNode(streetname);
					streeta.appendChild(streettext);
					streetnode.appendChild(streeta);
					streetlist.appendChild(streetnode);
				}
				citynode.appendChild(streetlist);
				branchdom.appendChild(citynode);
			}
			var htm = branches.html();
			wholetree.innerHTML = inner1 + htm + inner2;

			$("#tree1").treeview({
//				add: branches
//				remove: branches
			});
		}

		function setDists() {
			var wholetree = document.getElementById("tree2");
			var temp = document.getElementById("folder1");
			var inner1 = "<li class='expandable'>";
			var inner2 = "</li>";
			var branches = $(inner1 + "<div class='hitarea expandable-hitarea'></div>" +
					"<a href='#' onclick='gotoDist(\'420000000\')'>湖北省</a><ul id='clist'></ul>" + inner2).appendTo("#folder1");
			var branchdom =$('#clist')[0];

			var subDistricts = distdata.subclasses;
			for (var i = 0; i < subDistricts.length; i += 1) {	//	省内各城市
				var city = subDistricts[i];
				var cityname = city.name;
				var citynode = document.createElement("li");
				var $cn = $(citynode);
				if(i == subDistricts.length - 1) {
					citynode.setAttribute("class", "last");
				} else {
					citynode.setAttribute("class", "expandable");
				}
				var citydiv = document.createElement("div");
				citydiv.setAttribute("class", "hitarea expandable-hitarea");
				var citya = document.createElement("a");
				citya.setAttribute("href", "#");
				citya.setAttribute("class", "");
				citya.setAttribute("onclick", "gotoDist('" + city.id + "')");
				var citytext = document.createTextNode(cityname);
				citya.appendChild(citytext);
				citynode.appendChild(citydiv);
				citynode.appendChild(citya);
				if (!city.subclasses) {
					branchdom.appendChild(citynode);
					continue;
				}
				var countylist = document.createElement("ul");
				countylist.setAttribute("style", "display: none;");
				for (var j = 0; j < city.subclasses.length; j++) {//	城市内各区县
					var county = city.subclasses[j];
					var countyname = county.name;
					var countynode = document.createElement("li");
					if(j == city.subclasses.length - 1) {
						countynode.setAttribute("class", "last");
					} else {
						countynode.setAttribute("class", "expandable");
					}
					var countydiv = document.createElement("div");
					countydiv.setAttribute("class", "hitarea expandable-hitarea");
					var countya = document.createElement("a");
					countya.setAttribute("href", "#");
					countya.setAttribute("onclick", "gotoDist('" + county.id + "')");
					var countytext = document.createTextNode(countyname);
					countya.appendChild(countytext);
					countynode.appendChild(countydiv);
					countynode.appendChild(countya);
					if (county.subclasses) {
						var streetlist = document.createElement("ul");
						streetlist.setAttribute("style", "display: none;");
						for (var k = 0; k < county.subclasses.length; k++) {	//	区县内各街道
							var street = county.subclasses[k];
							var streetname = street.name;
							var streetnode = document.createElement("li");
							var streeta = document.createElement("a");
							streeta.setAttribute("href", "#");
							streeta.setAttribute("onclick", "gotoDist('" + street.id + "')");
							var streettext = document.createTextNode(streetname);
							streeta.appendChild(streettext);
							streetnode.appendChild(streeta);
							streetlist.appendChild(streetnode);
						}
						countynode.appendChild(streetlist);
					}
					countylist.appendChild(countynode);
				}
				citynode.appendChild(countylist);
				branchdom.appendChild(citynode);
			}
			var htm = branches.html();
			wholetree.innerHTML = inner1 + htm + inner2;

			$("#tree2").treeview({
//				add: branches
//				remove: branches
			});
		}

		function initmarkers(pdata) {
			for (var i = 0; i < placedata.length; i++) {
				var data = placedata[i];
				var marker = new AMap.Marker({
					map: map,
					position: data.position,
					zIndex: 3,
					extData: data,
					title: data.name,

				});
				AMap.event.addListener(marker, "click", mapFeatureClick);
				markers.push(marker);
			}
			if(pdata) {
				showingPlaces = pdata;
				showNarkers(pdata);
			} else {
				showingPlaces = placedata;
			}
		}

		function showNarkers(pdata) {
			for (var i = 0; i < pdata.length; i++) {
				var data = pdata[i];
				var marker = new AMap.Marker({
					map: map,
					position: data.position,
					zIndex: 3,
					extData: data,
					title: data.name,
					label: data.name.substring(0, 1),
				});
				AMap.event.addListener(marker, "click", mapFeatureClick);
				markers.push(marker);
			}
		}

		$("#tree1").treeview({
			collapsed: true,
			animated: "fast",
			control:"#sidetreecontrol1",
			prerendered: true,
			persist: "location"
		});

		$("#tree2").treeview({
//			collapsed: true,
//			animated: "medium",
			control:"#sidetreecontrol2",
//			prerendered: true,
//			persist: "location"
		});

		$(document).ready(function(){

		});

		$(function() {
			setTypes();
			setDists();
//			$("#suggest13").autocomplete(placedata, {
//
//				minChars: 0,
//				width: 310,
////				matchContains: "word",
//				autoFill: true,
//				formatItem: function(row, i, max) {
//					return row.name;
//				},
//				formatMatch: function(row, i, max) {
//					return row.name;
//				},
//				formatResult: function(row) {
//					return row.name;
//				}
//			});
			$("#autocomplete").autocomplete(placedata, {

				minChars: 0,
				width: 310,
//					matchContains: "word",
				autoFill: true,
				formatItem: function(row, i, max) {
					return row.nickname;
				},
				formatMatch: function(row, i, max) {
					return row.nickname;
				},
				formatResult: function(row) {
					return row.nickname;
				}
			});

		});

		map = new AMap.Map('mapContainer',{
			resizeEnable: true,
			center: [109.461756,30.285877],
			zoom:level
		});
		map.on('complete', function(){
			map.plugin(["AMap.ToolBar", "AMap.OverView", "AMap.Scale"], function(){
				map.addControl(new AMap.ToolBar);
				map.addControl(new AMap.OverView({isOpen: true}));
				map.addControl(new AMap.Scale);
			});
		});

		showingPlaces = placedata;

		initmarkers();
//		showNarkers(showingPlaces);
		map.setFitView();

	</script>

</body>

</html>
